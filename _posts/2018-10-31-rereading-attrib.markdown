---
layout: post
title:  "Введение в OpenSceneGraph: Обновление геометрических атрибутов"
date:   2018-10-31 12:28:00 +0300
categories: jekyll update
---

Класс osg::Geometry управляет множеством данных, описывающих вершины и отображает полигональную сетку с использованием упорядоченного набора примитивов. Однако, данный класс не имеет представления о таких элементах топологии модели как грани, ребра и соотношения между ними. Этот нюанс мешает реализации таких вещей как перемещение определенных граней, например при анимировании моделей. В настоящее время OSG не поддерживает такую функциональность.

Однако в движке реализован ряд функторов, позволяющих перечитать атрибуты геометрии любого объекта и использовать их в целях моделирования топологии полигональной сетки. В C++ функтором называется конструкция, позволяющая использовать объект как функцию. 

Класс osg::Drawable предосталяет разработчику четыре типа функторов

1. osg::Drawable::AttributeFunctor - читает атрибуты вершин как массив указателей. Он имеет ряд виртуальных методов для применения атрибутов вершин разных типов данных. Для использования этого функтора необходимо описать класс и переопределить один или более его методов, внутри которых выполняются требуемые разработчику действия

```cpp
virtual void apply( osg::Drawable::AttributeType type, 
					unsigned int size, osg::Vec3* ptr )
{
	// Читаем 3-векторы в буффер с указателем ptr.
	// Первый параметр определяет тип атрибута
}
```

2. osg::Drawable::ConstAttributeFunctor - read-only версия предыдущего функтора: указатель на массив векторов передается как константный параметр
3. osg::PrimitiveFunctor - имитирует процесс рендеринга объектов OpenGL. Под видом рендеринга объекта производится вызов переопрелеенных разработчиком методов функтора. Этот функтор имеет два важных шаблонных подкласса: osg::TemplatePrimitiveFunctor<> и osg::TriangleFunctor<>. Эти классы получают в качестве параметров вершины примитива и передают их в пользовательские методы с применением оператора operator().
4. osg::PrimitiveIndexFunctor - выполняет те же действия, что и предыдущий функтор, но в качестве параметра принимает индексы вершин примитива.

Классы, производные от osg::Drawable, такие как osg::ShapeDrawable и osg::Geometry имеют метод accept() позволяющий применить различные функторы.

## Пример использования функтора примитивов

Проилюстрируем описанный функционал, на примере сбора информации о треугольных гранях и точках некоторой, определенной нами заранее геометрии.