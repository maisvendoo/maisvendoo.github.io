---
layout: post
title:  "Введение в OpenSceneGraph: Применение класса osg::Geometry" 
date:   2018-10-30 13:40:00 +0300
categories: jekyll update
---

Как говорилось выше, OSG поддерживает методику создания примитивов из массивов вершин и использует буфер вершин для ускорения рендеринга. Для управления этим процессом в движке предусмотрено два механизма.

## Хранение данных геометрии: класс osg::Array

Класс osg::Array, как и многие другие из рассмотренных выше, является классом абстрактным, от которого наследуются несколько потомков, предназначенных для хранения данных, передаваемых в функции OpenGL. Идеология работы с данным классом подобна классу std::vector из стандартной библиотеки C++. Следующий код иллюстрирует добавление вектора в массив вершин методом push_back()

```cpp
vertices->push_back(osg::Vec3(1.0f, 0.0f, 0.0f));
```

Массивы OSG выделяются в куче и управляются посредством умных указателей. Однако это не касается элементов массивов, таких как osg::Vec3 или osg::Vec2, которые могут быть созданы и на стеке.

Класс osg::Geometry является высокоуровневой оберткой над функциями OpenGL, работающими с массивами вершин. Он является производным от класса osg::Drawable и может быть без проблем добавлен в список объектов osg::Geode. Этот класс принимает вышеописанные массивы в качестве входных данных и использует их для генерации геометрии средствами OpenGL.

## Вершины и их атрибуты

Вершина является атомарной единицей примитивов геометрии. Она обладает рядом атрибутов, описывающих точку двух- или трехмерного пространства. К атрибутам относятся: положение, цвет, вектор-нормаль, текстурные координаты, координаты тумана и т.д. Вершина всегда должна иметь положение в пространстве, что касается других атрибутов, они могут присутствовать опционально. OpenGL поддерживает 16 базовых атрибутов вершины и может создавать разные массивы для их хранения. Все массивы атрибутов поддерживаются классом osg::Geometry и могут быть заданы методами вида set*Array().

**Атрибуты вершин в OpenSceneGraph**

|---------|----------|-------------------|--------------------------|
| Атрибут |Тип данных|метод osg::Geometry|Эквивалентный вызов OpenGL|
|---------|----------|-------------------|--------------------------|
|Положение|3D-вектор |setVertexArray()   |glVertexPointer()         |
|Нормаль  |3D-вектор |setNormalArray()   |glNormalPointer()         |
|Цвет     |4D-вектор |setColorArray()    |glColorPointer()
